<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Image to Prompt</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#020617">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f172a;color:#e5e7eb;
  font-family:Arial;
  display:flex;justify-content:center;align-items:center;
  min-height:100vh;
}
.card{
  width:420px;background:#020617;
  padding:20px;border-radius:14px;
}
textarea{width:100%;height:220px;margin-top:10px;}
button{width:100%;margin-top:10px;}
</style>
</head>

<body>
<div class="card">
<h2>üì∑ AI Image ‚Üí Prompt</h2>

<input type="file" id="img" accept="image/*">
<select id="style">
  <option>realistic</option>
  <option>cinematic</option>
  <option>anime</option>
  <option>3d illustration</option>
</select>

<textarea id="out" placeholder="AI prompt will appear here..."></textarea>
<button onclick="send()">Generate Prompt</button>
</div>

<script>
let imageData = "";

document.getElementById("img").onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  const img = new Image();
  const reader = new FileReader();

  reader.onload = () => img.src = reader.result;
  reader.readAsDataURL(file);

  img.onload = () => {
    const canvas = document.createElement("canvas");

    const MAX_WIDTH = 1024;
    const scale = MAX_WIDTH / img.width;

    canvas.width = MAX_WIDTH;
    canvas.height = img.height * scale;

    const ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    imageData = canvas.toDataURL("image/jpeg", 0.7); // compressed
  };
};

async function send() {
  document.getElementById("out").value = "Analyzing image...";

  try {
    const res = await fetch("/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        image: imageData,
        style: document.getElementById("style").value
      })
    });

    if (!res.ok) {
      throw new Error(await res.text());
    }

    const data = await res.json();
    document.getElementById("out").value = data.prompt;

  } catch (err) {
    document.getElementById("out").value =
      "‚ùå Image too large. Please try a smaller image.";
  }
}
</script>

</body>
</html>
